/*
 * transfer-rate v1.0.0
 * (c) hex7c0 http://supergiovane.tk/#/transfer-rate
 * Licensed under GPLv3
 */
"use strict";function wrapper(a){function b(b,c,d){var g=process.hrtime(c);g=1e9*g[0]+g[1];var h=b._bytesDispatched*a.byte/a.misura;return d&&(e=new Array(2),f._bytesDispatched=0),(h/(g/a.time)).toFixed(1)+a.out}function c(b,c,d){var g=process.hrtime(c);g=1e9*g[0]+g[1];var h=b.bytesRead*a.byte/a.misura;return d&&(e=new Array(2),f.bytesRead=0),(h/(g/a.time)).toFixed(1)+a.out}var d=b;a.response||(d=c);var e=new Array(2),f={_bytesDispatched:0,bytesRead:0};return function(a,b){function c(){f._bytesDispatched+=j._bytesDispatched,f.bytesRead+=j.bytesRead}function g(){return h(),e[1]?(f._bytesDispatched+=j._bytesDispatched,f.bytesRead+=j.bytesRead,a.transferRate=d(f,e,!0)):void 0}function h(){j.removeListener("close",c)}if(!a)throw new TypeError("req required");if(!b||!Array.isArray(b))throw new TypeError("start required");var i=a.res;if(e[1]||(e=b),i._headerSent)return a.transferRate=d(a.socket,e);var j=a.socket;j.once("close",g)}}module.exports=function(a){var a=a||Object.create(null),b={misura:1024,"byte":1,out:" KB/s",time:1e9,response:!0};return"Byte"==a.data?(b.misura=1,b.byte=1,b.out=" Byte"):"KB"==a.data?(b.misura=1024,b.byte=1,b.out=" KB"):"MB"==a.data?(b.misura=1048576,b.byte=1,b.out=" MB"):"bit"==a.data?(b.misura=1,b.byte=8,b.out=" bit"):"Kb"==a.data?(b.misura=1e3,b.byte=8,b.out=" Kbit"):"Mb"==a.data&&(b.misura=1e6,b.byte=8,b.out=" Mbit"),"nanosecond"==a.time?(b.time=1,b.out+="/ns"):"millisecond"==a.time?(b.time=1e6,b.out+="/ms"):"second"==a.time&&(b.time=1e9,b.out+="/s"),0==a.response&&(b.response=!1),0==a.output&&(b.out=""),wrapper(b)};
